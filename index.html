<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Programme ‚Äî Classe 4AM2</title>
  <style>
    :root{--bg1:#3b82f6;--bg2:#7c3aed;--card-bg: rgba(255,255,255,0.88);--muted:#475569}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{background: linear-gradient(135deg,var(--bg1), #6366f1 40%, var(--bg2));-webkit-font-smoothing:antialiased;color:#0f172a;padding:28px;box-sizing:border-box}
    .wrap{max-width:1100px;margin:0 auto;background:var(--card-bg);backdrop-filter:blur(6px);border-radius:18px;padding:22px;box-shadow:0 10px 30px rgba(2,6,23,0.2)}
    header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    h1{margin:0;font-size:1.4rem}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:0.95rem}
    .controls{display:flex;gap:8px;align-items:center}
    button{cursor:pointer;border:0;padding:8px 12px;border-radius:8px;background:#eef2ff}
    button.primary{background:linear-gradient(90deg,#4f46e5,#06b6d4);color:white}
    button.ghost{background:transparent;border:1px solid rgba(15,23,42,0.08)}
    main{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .gallery{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .card{background:white;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06);cursor:pointer;display:flex;flex-direction:column}
    .card img{width:100%;height:140px;object-fit:cover;display:block}
    .card .meta{padding:10px}
    .card h3{margin:0;font-size:1rem}
    .card p{margin:6px 0 0;font-size:0.85rem;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .card .card-actions{margin-top:10px;display:flex;gap:8px}
    .pane{background:white;border-radius:12px;padding:12px;height:100%;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column}
    .pane img{width:100%;height:160px;object-fit:cover;border-radius:8px}
    .pane .title-row{display:flex;justify-content:space-between;align-items:center}
    .muted{color:var(--muted)}
    label{font-size:0.82rem;color:var(--muted);display:block;margin-top:8px}
    input[type=text], textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;margin-top:6px}
    textarea{resize:vertical}
    .row{display:flex;gap:8px}
    .footer{margin-top:14px;font-size:0.82rem;color:var(--muted)}
    .admin-badge{background:#111827;color:white;padding:6px 8px;border-radius:8px;font-size:0.82rem}

    /* modal */
    .modal-back{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center}
    .modal{background:white;border-radius:10px;padding:18px;max-width:420px;width:96%;box-shadow:0 12px 40px rgba(2,6,23,0.4)}

    @media(max-width:900px){main{grid-template-columns:1fr} .gallery{grid-template-columns:repeat(2,1fr)} .pane{order:2}}
    @media(max-width:520px){.gallery{grid-template-columns:1fr}} 
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Programme ‚Äî Classe 4AM2</h1>
        <p class="lead">Clique sur une image pour ouvrir la fiche du sujet. Mode √©dition prot√©g√© par mot de passe.</p>
      </div>
      <div class="controls">
        <button id="btnNew" class="primary" style="display:none">+ Nouveau</button>
        <button id="btnReset" class="ghost" style="display:none">R√©initialiser</button>
        <button id="btnAdmin" class="ghost">üîí Connexion admin</button>
        <button id="btnLogout" class="ghost" style="display:none">Se d√©connecter</button>
      </div>
    </header>

    <main>
      <section>
        <div id="gallery" class="gallery" aria-live="polite"></div>
      </section>

      <aside class="pane" id="detailPane">
        <div id="emptyState">
          <h2>Aucune page ouverte</h2>
          <p class="muted">Clique sur une image dans la galerie pour voir la fiche et la modifier (si tu es admin).</p>
        </div>

        <div id="detail" style="display:none;flex:1;flex-direction:column;">
          <div class="title-row">
            <h2 id="detailTitle">Titre</h2>
            <div>
              <button id="btnEdit" class="ghost" style="display:none">√âditer</button>
              <button id="btnDelete" style="display:none;background:#ef4444;color:white;border-radius:8px;padding:8px 10px">Suppr</button>
            </div>
          </div>

          <img id="detailImage" src="" alt="image sujet" style="margin-top:10px">
          <div id="viewDescription" style="margin-top:10px;flex:1">
            <p id="detailDesc" class="muted"></p>
          </div>

          <form id="editForm" style="display:none;margin-top:8px;flex:1;flex-direction:column;">
            <label>Titre</label>
            <input id="inpTitle" type="text" />
            <label>URL de l'image</label>
            <input id="inpImage" type="text" />
            <label>Description</label>
            <textarea id="inpDesc" rows="5"></textarea>

            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="btnSave" class="primary" type="button">Enregistrer</button>
              <button id="btnCancel" class="ghost" type="button">Annuler</button>
            </div>
          </form>

          <div class="footer">Site statique ‚Äî le mot de passe est stock√© dans le fichier. Pour plus de s√©curit√©, utilisez un vrai backend.</div>
        </div>
      </aside>
    </main>
  </div>

  <!-- modal login -->
  <div id="modal" style="display:none" class="modal-back">
    <div class="modal">
      <h3>Connexion admin</h3>
      <p class="muted">Entre le mot de passe admin pour activer l'√©dition.</p>
      <label style="margin-top:10px">Mot de passe</label>
      <input id="adminPwd" type="password" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;margin-top:6px"/>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button id="modalCancel" class="ghost">Annuler</button>
        <button id="modalOk" class="primary">Se connecter</button>
      </div>
    </div>
  </div>

  <script>
    // ----- CONFIG -----
    // change this password before d√©ploy (default below)
    const ADMIN_PASSWORD = '12342301Azerty1342#81e+31#lebestevere+51';
    const STORAGE_KEY = 'subjects_4am2_html';
    const ADMIN_FLAG = 'isAdmin_4am2';

    // Donn√©es par d√©faut
    const DEFAULT_SUBJECTS = [
      {id:'math', title:'Math√©matiques', image:'https://picsum.photos/seed/math/800/600', description:'Alg√®bre, g√©om√©trie et exercices pour 4AM2.'},
      {id:'fr', title:'Fran√ßais', image:'https://picsum.photos/seed/fr/800/600', description:'Lecture, grammaire et expression √©crite.'},
      {id:'phy', title:'Physique', image:'https://picsum.photos/seed/phy/800/600', description:'Forces, √©nergie et petits TP.'},
      {id:'prog', title:'Programme', image:'https://picsum.photos/seed/prog/800/600', description:"Le programme principal de la classe (emplois du temps, objectifs...)."},
      {id:'hist', title:'Histoire', image:'https://picsum.photos/seed/hist/800/600', description:'√âv√©nements historiques et chronologie.'},
      {id:'eng', title:'Anglais', image:'https://picsum.photos/seed/eng/800/600', description:'Vocabulaire et compr√©hension orale.'}
    ];

    let subjects = loadSubjects();
    let current = null;

    // DOM
    const gallery = document.getElementById('gallery');
    const btnNew = document.getElementById('btnNew');
    const btnReset = document.getElementById('btnReset');
    const btnAdmin = document.getElementById('btnAdmin');
    const btnLogout = document.getElementById('btnLogout');
    const modal = document.getElementById('modal');
    const adminPwd = document.getElementById('adminPwd');
    const modalOk = document.getElementById('modalOk');
    const modalCancel = document.getElementById('modalCancel');

    const emptyState = document.getElementById('emptyState');
    const detail = document.getElementById('detail');
    const detailTitle = document.getElementById('detailTitle');
    const detailImage = document.getElementById('detailImage');
    const detailDesc = document.getElementById('detailDesc');
    const viewDescription = document.getElementById('viewDescription');

    const btnEdit = document.getElementById('btnEdit');
    const btnDelete = document.getElementById('btnDelete');
    const editForm = document.getElementById('editForm');
    const inpTitle = document.getElementById('inpTitle');
    const inpImage = document.getElementById('inpImage');
    const inpDesc = document.getElementById('inpDesc');
    const btnSave = document.getElementById('btnSave');
    const btnCancel = document.getElementById('btnCancel');

    // init
    renderGallery();
    updateAdminUI(isAdmin());

    // events
    btnNew.addEventListener('click', () => {
      const id = 'sub_' + Date.now();
      const newSub = { id, title: 'Nouveau sujet', image: 'https://picsum.photos/seed/new' + Math.floor(Math.random()*9999) + '/800/600', description: 'Description...' };
      subjects.unshift(newSub);
      saveSubjects();
      renderGallery();
      openSubject(id);
    });

    btnReset.addEventListener('click', ()=>{
      if(!confirm('R√©initialiser la liste de sujets ?')) return;
      subjects = JSON.parse(JSON.stringify(DEFAULT_SUBJECTS));
      saveSubjects();
      renderGallery();
      closeDetail();
    });

    btnAdmin.addEventListener('click', ()=>{ openModal(); });
    btnLogout.addEventListener('click', ()=>{ logout(); });
    modalCancel.addEventListener('click', ()=>{ closeModal(); });
    modalOk.addEventListener('click', ()=>{ tryAdminLogin(); });
    adminPwd.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') tryAdminLogin(); });

    btnEdit.addEventListener('click', ()=>{ setEditing(true); });
    btnDelete.addEventListener('click', ()=>{ if(!current) return; if(!confirm('Supprimer ce sujet ?')) return; subjects = subjects.filter(s => s.id !== current.id); saveSubjects(); renderGallery(); closeDetail(); });
    btnSave.addEventListener('click', ()=>{ if(!current) return; const t = inpTitle.value.trim() || 'Sans titre'; const im = inpImage.value.trim() || 'https://picsum.photos/seed/placeholder/800/600'; const d = inpDesc.value.trim() || ''; subjects = subjects.map(s => s.id === current.id ? {...s, title:t, image:im, description:d} : s); saveSubjects(); renderGallery(); openSubject(current.id); });
    btnCancel.addEventListener('click', ()=>{ setEditing(false); });

    function renderGallery(){
      gallery.innerHTML = '';
      subjects.forEach(s => {
        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <img src="${escapeHtml(s.image)}" alt="${escapeHtml(s.title)}">
          <div class=\"meta\">
            <h3>${escapeHtml(s.title)}</h3>
            <p>${escapeHtml(s.description)}</p>
            <div class=\"card-actions\">
              <button data-open=\"${s.id}\">Ouvrir</button>
              <button data-del=\"${s.id}\" style=\"display:${isAdmin() ? 'inline-block' : 'none'}\">Suppr</button>
            </div>
          </div>
        `;
        gallery.appendChild(el);
      });

      gallery.querySelectorAll('[data-open]').forEach(b => b.addEventListener('click', (e)=>{ openSubject(e.target.getAttribute('data-open')); }));
      gallery.querySelectorAll('[data-del]').forEach(b => b.addEventListener('click', (e)=>{
        const id = e.target.getAttribute('data-del');
        if(!confirm('Supprimer ce sujet ?')) return;
        subjects = subjects.filter(s=>s.id!==id);
        if(current && current.id===id) closeDetail();
        saveSubjects(); renderGallery();
      }));
    }

    function openSubject(id){
      const s = subjects.find(x => x.id===id);
      if(!s) return;
      current = s;
      emptyState.style.display = 'none';
      detail.style.display = 'flex';
      detailTitle.textContent = s.title;
      detailImage.src = s.image;
      detailDesc.textContent = s.description;
      setEditing(false);
    }

    function closeDetail(){ current = null; emptyState.style.display = ''; detail.style.display = 'none'; }

    function setEditing(flag){ if(!current) return; if(flag){ editForm.style.display = 'flex'; viewDescription.style.display = 'none'; inpTitle.value = current.title; inpImage.value = current.image; inpDesc.value = current.description; } else { editForm.style.display = 'none'; viewDescription.style.display = ''; } }

    function loadSubjects(){ try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw) return JSON.parse(raw); }catch(e){} return JSON.parse(JSON.stringify(DEFAULT_SUBJECTS)); }
    function saveSubjects(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(subjects)); }catch(e){console.warn(e)} }

    function escapeHtml(str){ return String(str).replace(/[&<>\"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]}); }

    // ----- admin helpers -----
    function isAdmin(){ try{ return localStorage.getItem(ADMIN_FLAG) === '1'; }catch(e){return false} }
    function updateAdminUI(flag){
      // header buttons
      btnNew.style.display = flag ? '' : 'none';
      btnReset.style.display = flag ? '' : 'none';
      btnLogout.style.display = flag ? '' : 'none';
      btnAdmin.style.display = flag ? 'none' : '';
      // detail actions
      btnEdit.style.display = flag ? '' : 'none';
      btnDelete.style.display = flag ? '' : 'none';
      // gallery delete buttons updated on render
      renderGallery();
    }
    function openModal(){ adminPwd.value=''; modal.style.display = 'flex'; adminPwd.focus(); }
    function closeModal(){ modal.style.display = 'none'; }
    function tryAdminLogin(){ const val = adminPwd.value || ''; if(val === ADMIN_PASSWORD){ try{ localStorage.setItem(ADMIN_FLAG,'1'); }catch(e){} updateAdminUI(true); closeModal(); alert('Mode admin activ√©. Tu peux maintenant modifier le contenu.'); } else { alert('Mot de passe incorrect.'); adminPwd.value=''; adminPwd.focus(); } }
    function logout(){ try{ localStorage.removeItem(ADMIN_FLAG); }catch(e){} updateAdminUI(false); alert('D√©connect√©.'); }
  </script>
</body>
</html>
